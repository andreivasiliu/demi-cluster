<!DOCTYPE html>
<html>
<head>
<style type="text/css">
  body {background-color: black; color: gray;}
  pre {
      font-weight: normal;
      color: #bbb;
      white-space: -moz-pre-wrap;
      white-space: -o-pre-wrap;
      white-space: -pre-wrap;
      white-space: pre-wrap;
      word-wrap: break-word;
      overflow-wrap: break-word;
  }
  b {font-weight: normal}
  b.BOLD {color: #fff}
  b.ITA {font-style: italic}
  b.UND {text-decoration: underline}
  b.STR {text-decoration: line-through}
  b.UNDSTR {text-decoration: underline line-through}
  b.BLK {color: #000000}
  b.RED {color: #aa0000}
  b.GRN {color: #00aa00}
  b.YEL {color: #aa5500}
  b.BLU {color: #0000aa}
  b.MAG {color: #aa00aa}
  b.CYN {color: #00aaaa}
  b.WHI {color: #aaaaaa}
  b.HIK {color: #555555}
  b.HIR {color: #ff5555}
  b.HIG {color: #55ff55}
  b.HIY {color: #ffff55}
  b.HIB {color: #5555ff}
  b.HIM {color: #ff55ff}
  b.HIC {color: #55ffff}
  b.HIW {color: #ffffff}
  b.BBLK {background-color: #000000}
  b.BRED {background-color: #aa0000}
  b.BGRN {background-color: #00aa00}
  b.BYEL {background-color: #aa5500}
  b.BBLU {background-color: #0000aa}
  b.BMAG {background-color: #aa00aa}
  b.BCYN {background-color: #00aaaa}
  b.BWHI {background-color: #aaaaaa}
</style>
</head>
<body>
  <table style="margin-left: auto; margin-right: auto;">
    <tr>
      <td>
	<img src="grumpy-demi.png"/>
      </td>
      <td>
	<pre><b style="color:#d700d7;">_</b><b style="color:#d700d7;">_</b><b style="color:#d700d7;"> </b><b style="color:#d700d7;"> </b><b style="color:#d700d7;"> </b><b style="color:#d700d7;"> </b><b style="color:#af00d7;"> </b><b style="color:#af00d7;"> </b><b style="color:#af00ff;">_</b><b style="color:#af00ff;">_</b><b style="color:#af00ff;"> </b><b style="color:#af00ff;"> </b><b style="color:#af00ff;"> </b><b style="color:#af00ff;">_</b><b style="color:#af00ff;"> </b><b style="color:#af00ff;"> </b><b style="color:#af00ff;"> </b><b style="color:#8700ff;"> </b><b style="color:#8700ff;"> </b><b style="color:#8700ff;"> </b><b style="color:#8700ff;"> </b><b style="color:#8700ff;"> </b><b style="color:#8700ff;"> </b><b style="color:#8700ff;"> </b><b style="color:#8700ff;"> </b><b style="color:#8700ff;"> </b><b style="color:#875fff;"> </b><b style="color:#5f5fff;"> </b><b style="color:#5f5fff;"> </b><b style="color:#5f5fff;"> </b><b style="color:#5f5fff;"> </b><b style="color:#5f5fff;"> </b><b style="color:#5f5fff;"> </b><b style="color:#5f5fff;"> </b><b style="color:#5f5fff;">_</b><b style="color:#5f5fff;"> </b><b style="color:#5f5fff;"> </b><b style="color:#5f5fff;"> </b><b style="color:#5f87ff;"> </b><b style="color:#0087ff;"> </b><b style="color:#0087ff;"> </b><b style="color:#0087ff;"> </b><b style="color:#0087ff;"> </b><b style="color:#0087ff;"> </b><b style="color:#0087ff;"> </b><b style="color:#0087ff;"> </b><b style="color:#0087ff;"> </b><b style="color:#0087ff;">_</b><b style="color:#00afff;"> </b><b style="color:#00afff;"> </b><b style="color:#00afff;"> </b><b style="color:#00afff;"> </b><b style="color:#00afff;"> </b><b style="color:#00afff;"> </b><b style="color:#00afff;"> </b><b style="color:#00afff;"> </b><b style="color:#00afff;"> </b><b style="color:#00afd7;"> </b><b style="color:#00afd7;"> </b><b style="color:#00d7d7;">_</b><b style="color:#00d7d7;"> </b><b style="color:#00d7d7;"> </b><b style="color:#00d7d7;"> </b><b style="color:#00d7d7;"> </b><b style="color:#00d7d7;"> </b><b style="color:#00d7d7;"> </b><b style="color:#00d7d7;"> </b><b style="color:#00d7d7;"> </b><b style="color:#00d7d7;"> </b><b style="color:#00d7af;"> </b><b style="color:#00ffaf;"> </b>
<b style="color:#d700d7;">\</b><b style="color:#d700d7;"> </b><b style="color:#d700d7;">\</b><b style="color:#af00d7;"> </b><b style="color:#af00d7;"> </b><b style="color:#af00ff;"> </b><b style="color:#af00ff;"> </b><b style="color:#af00ff;">/</b><b style="color:#af00ff;"> </b><b style="color:#af00ff;">/</b><b style="color:#af00ff;">_</b><b style="color:#af00ff;">_</b><b style="color:#af00ff;">|</b><b style="color:#af00ff;"> </b><b style="color:#8700ff;">|</b><b style="color:#8700ff;">_</b><b style="color:#8700ff;">_</b><b style="color:#8700ff;"> </b><b style="color:#8700ff;">_</b><b style="color:#8700ff;">_</b><b style="color:#8700ff;">_</b><b style="color:#8700ff;"> </b><b style="color:#8700ff;">_</b><b style="color:#875fff;"> </b><b style="color:#5f5fff;">_</b><b style="color:#5f5fff;">_</b><b style="color:#5f5fff;"> </b><b style="color:#5f5fff;"> </b><b style="color:#5f5fff;">_</b><b style="color:#5f5fff;">_</b><b style="color:#5f5fff;">_</b><b style="color:#5f5fff;"> </b><b style="color:#5f5fff;"> </b><b style="color:#5f5fff;">|</b><b style="color:#5f5fff;"> </b><b style="color:#5f87ff;">|</b><b style="color:#0087ff;">_</b><b style="color:#0087ff;"> </b><b style="color:#0087ff;">_</b><b style="color:#0087ff;">_</b><b style="color:#0087ff;">_</b><b style="color:#0087ff;"> </b><b style="color:#0087ff;"> </b><b style="color:#0087ff;"> </b><b style="color:#0087ff;">_</b><b style="color:#00afff;">_</b><b style="color:#00afff;">|</b><b style="color:#00afff;"> </b><b style="color:#00afff;">|</b><b style="color:#00afff;">_</b><b style="color:#00afff;">_</b><b style="color:#00afff;">_</b><b style="color:#00afff;"> </b><b style="color:#00afff;">_</b><b style="color:#00afd7;"> </b><b style="color:#00afd7;">_</b><b style="color:#00d7d7;">_</b><b style="color:#00d7d7;"> </b><b style="color:#00d7d7;">(</b><b style="color:#00d7d7;">_</b><b style="color:#00d7d7;">)</b><b style="color:#00d7d7;"> </b><b style="color:#00d7d7;"> </b><b style="color:#00d7d7;">_</b><b style="color:#00d7d7;"> </b><b style="color:#00d7d7;">_</b><b style="color:#00d7af;"> </b><b style="color:#00ffaf;">_</b><b style="color:#00ffaf;">_</b><b style="color:#00ffaf;">_</b><b style="color:#00ffaf;"> </b>
<b style="color:#af00d7;"> </b><b style="color:#af00d7;">\</b><b style="color:#af00ff;"> </b><b style="color:#af00ff;">\</b><b style="color:#af00ff;">/</b><b style="color:#af00ff;">\</b><b style="color:#af00ff;">/</b><b style="color:#af00ff;"> </b><b style="color:#af00ff;">/</b><b style="color:#af00ff;"> </b><b style="color:#af00ff;">-</b><b style="color:#8700ff;">_</b><b style="color:#8700ff;">)</b><b style="color:#8700ff;"> </b><b style="color:#8700ff;">/</b><b style="color:#8700ff;"> </b><b style="color:#8700ff;">_</b><b style="color:#8700ff;">/</b><b style="color:#8700ff;"> </b><b style="color:#8700ff;">_</b><b style="color:#875fff;"> </b><b style="color:#5f5fff;">\</b><b style="color:#5f5fff;"> </b><b style="color:#5f5fff;">'</b><b style="color:#5f5fff;"> </b><b style="color:#5f5fff;"> </b><b style="color:#5f5fff;">\</b><b style="color:#5f5fff;">/</b><b style="color:#5f5fff;"> </b><b style="color:#5f5fff;">-</b><b style="color:#5f5fff;">_</b><b style="color:#5f5fff;">)</b><b style="color:#5f87ff;"> </b><b style="color:#0087ff;">|</b><b style="color:#0087ff;"> </b><b style="color:#0087ff;"> </b><b style="color:#0087ff;">_</b><b style="color:#0087ff;">/</b><b style="color:#0087ff;"> </b><b style="color:#0087ff;">_</b><b style="color:#0087ff;"> </b><b style="color:#0087ff;">\</b><b style="color:#00afff;"> </b><b style="color:#00afff;">/</b><b style="color:#00afff;"> </b><b style="color:#00afff;">_</b><b style="color:#00afff;">`</b><b style="color:#00afff;"> </b><b style="color:#00afff;">/</b><b style="color:#00afff;"> </b><b style="color:#00afff;">-</b><b style="color:#00afd7;">_</b><b style="color:#00afd7;">)</b><b style="color:#00d7d7;"> </b><b style="color:#00d7d7;">'</b><b style="color:#00d7d7;"> </b><b style="color:#00d7d7;"> </b><b style="color:#00d7d7;">\</b><b style="color:#00d7d7;">|</b><b style="color:#00d7d7;"> </b><b style="color:#00d7d7;">|</b><b style="color:#00d7d7;">_</b><b style="color:#00d7d7;">|</b><b style="color:#00d7af;"> </b><b style="color:#00ffaf;">'</b><b style="color:#00ffaf;">_</b><b style="color:#00ffaf;">/</b><b style="color:#00ffaf;"> </b><b style="color:#00ffaf;">_</b><b style="color:#00ffaf;"> </b><b style="color:#00ffaf;">\</b>
<b style="color:#af00ff;"> </b><b style="color:#af00ff;"> </b><b style="color:#af00ff;">\</b><b style="color:#af00ff;">_</b><b style="color:#af00ff;">/</b><b style="color:#af00ff;">\</b><b style="color:#af00ff;">_</b><b style="color:#af00ff;">/</b><b style="color:#8700ff;">\</b><b style="color:#8700ff;">_</b><b style="color:#8700ff;">_</b><b style="color:#8700ff;">_</b><b style="color:#8700ff;">|</b><b style="color:#8700ff;">_</b><b style="color:#8700ff;">\</b><b style="color:#8700ff;">_</b><b style="color:#8700ff;">_</b><b style="color:#875fff;">\</b><b style="color:#5f5fff;">_</b><b style="color:#5f5fff;">_</b><b style="color:#5f5fff;">_</b><b style="color:#5f5fff;">/</b><b style="color:#5f5fff;">_</b><b style="color:#5f5fff;">|</b><b style="color:#5f5fff;">_</b><b style="color:#5f5fff;">|</b><b style="color:#5f5fff;">_</b><b style="color:#5f5fff;">\</b><b style="color:#5f5fff;">_</b><b style="color:#5f87ff;">_</b><b style="color:#0087ff;">_</b><b style="color:#0087ff;">|</b><b style="color:#0087ff;"> </b><b style="color:#0087ff;"> </b><b style="color:#0087ff;">\</b><b style="color:#0087ff;">_</b><b style="color:#0087ff;">_</b><b style="color:#0087ff;">\</b><b style="color:#0087ff;">_</b><b style="color:#00afff;">_</b><b style="color:#00afff;">_</b><b style="color:#00afff;">/</b><b style="color:#00afff;"> </b><b style="color:#00afff;">\</b><b style="color:#00afff;">_</b><b style="color:#00afff;">_</b><b style="color:#00afff;">,</b><b style="color:#00afff;">_</b><b style="color:#00afd7;">\</b><b style="color:#00afd7;">_</b><b style="color:#00d7d7;">_</b><b style="color:#00d7d7;">_</b><b style="color:#00d7d7;">|</b><b style="color:#00d7d7;">_</b><b style="color:#00d7d7;">|</b><b style="color:#00d7d7;">_</b><b style="color:#00d7d7;">|</b><b style="color:#00d7d7;">_</b><b style="color:#00d7d7;">|</b><b style="color:#00d7d7;">_</b><b style="color:#00d7af;">(</b><b style="color:#00ffaf;">_</b><b style="color:#00ffaf;">)</b><b style="color:#00ffaf;">_</b><b style="color:#00ffaf;">|</b><b style="color:#00ffaf;"> </b><b style="color:#00ffaf;">\</b><b style="color:#00ffaf;">_</b><b style="color:#00ffaf;">_</b><b style="color:#00ffaf;">_</b><b style="color:#00ffaf;">/</b>
<b style="color:#af00ff;"> </b><b style="color:#af00ff;"> </b><b style="color:#af00ff;"> </b><b style="color:#af00ff;"> </b><b style="color:#af00ff;"> </b><b style="color:#8700ff;"> </b><b style="color:#8700ff;"> </b><b style="color:#8700ff;"> </b><b style="color:#8700ff;"> </b><b style="color:#8700ff;"> </b><b style="color:#8700ff;"> </b><b style="color:#8700ff;"> </b><b style="color:#8700ff;"> </b><b style="color:#8700ff;"> </b><b style="color:#875fff;"> </b><b style="color:#5f5fff;"> </b><b style="color:#5f5fff;"> </b><b style="color:#5f5fff;"> </b><b style="color:#5f5fff;"> </b><b style="color:#5f5fff;"> </b><b style="color:#5f5fff;"> </b><b style="color:#5f5fff;"> </b><b style="color:#5f5fff;"> </b><b style="color:#5f5fff;"> </b><b style="color:#5f5fff;"> </b><b style="color:#5f5fff;"> </b><b style="color:#5f87ff;"> </b><b style="color:#0087ff;"> </b><b style="color:#0087ff;"> </b><b style="color:#0087ff;"> </b><b style="color:#0087ff;"> </b><b style="color:#0087ff;"> </b><b style="color:#0087ff;"> </b><b style="color:#0087ff;"> </b><b style="color:#0087ff;"> </b><b style="color:#0087ff;"> </b><b style="color:#00afff;"> </b><b style="color:#00afff;"> </b><b style="color:#00afff;"> </b><b style="color:#00afff;"> </b><b style="color:#00afff;"> </b><b style="color:#00afff;"> </b><b style="color:#00afff;"> </b><b style="color:#00afff;"> </b><b style="color:#00afff;"> </b><b style="color:#00afd7;"> </b><b style="color:#00afd7;"> </b><b style="color:#00d7d7;"> </b><b style="color:#00d7d7;"> </b><b style="color:#00d7d7;"> </b><b style="color:#00d7d7;"> </b><b style="color:#00d7d7;"> </b><b style="color:#00d7d7;"> </b><b style="color:#00d7d7;"> </b><b style="color:#00d7d7;"> </b><b style="color:#00d7d7;"> </b><b style="color:#00d7d7;"> </b><b style="color:#00d7af;"> </b><b style="color:#00ffaf;"> </b><b style="color:#00ffaf;"> </b><b style="color:#00ffaf;"> </b><b style="color:#00ffaf;"> </b><b style="color:#00ffaf;"> </b><b style="color:#00ffaf;"> </b><b style="color:#00ffaf;"> </b><b style="color:#00ffaf;"> </b><b style="color:#00ffaf;"> </b><b style="color:#00ffaf;"> </b><b style="color:#00ff87;"> </b><b style="color:#00ff87;"> </b><b style="color:#00ff87;"> </b>
	</pre>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top; text-align: left;">
	<ul style="list-style-type: square; padding: 15px;">
	  <li><a href="https://nas.demi.ro">NAS</a></li>
	  <li><a href="https://demi.ro">here</a></li>
	  <li><a href="/key">key setup</a></li>
	</ul>
      </td>
      <td style="vertical-align: top; text-align: left; width: 600px">
	<p>
	  Welcome to demi.ro! This is a personal server cluster, built in order to learn how to make an ansible-constructed load-balanced always-on self-hosted mini-cloud.
	</p>

	<p>
	  This page is served by: <span style="color: darkgreen;">{{ inventory_hostname }}</span>.
	</p>

	<p>
	  What's special about it is that every week, one of the cluster's servers automatically goes down and is reconstructed from scratch in a brand new virtual machine, to prove the concept of configuration-as-code and infrastructure-as-code through ansible and vagrant. Currently this page is just a test, and the "automatic" part is manually triggered. But so far everything has been set up via ansible, and the whole plan should be complete by the end of 2020!
	</p>

	<p>
	  Demi is the name of this cluster and its servers. Wondering what it means? Demi is the main character of <a href="http://www.cloudbuiltgame.com/">Cloudbuilt</a>, a parkour game in a dreamt-up cloudscape. This server cluster is made up of two boxes, and each box is split into two OSes. With the half and half nature of this cluster, Demi sounds like a super-appropriate name! Also check out its <a href="https://jacoblincke.bandcamp.com/album/super-cloudbuilt">amazing soundtrack</a>, with its killer amalgamation of all the album's leitmotifs, appropriately named <a href="https://jacoblincke.bandcamp.com/track/monolith-3">Monolith</a>; I was listening to it while <a href="https://gist.github.com/andreivasiliu/5a03e1d2fb0d8292ff2554186b8fc09b">dreaming up</a> this cluster.
	</p>

	<p>
	  Also, that banner up there? It's also the cluster's motd that is shown on ssh login, and I liked it so much that I repurposed it to html as well. It's made with this: <code>figlet -f small Welcome to demi.ro | lolcat --seed 25 --force | ansi2html</code>. The commands are all available in Debian's repos.
	</p>

	<p>
	  So, stuff that is already done and working via ansible:
	  <ul>
	    <li>Initial provisioning of the base system  (users, permissions, keys, etc)</li>
	    <li>Host-by-host execution, taking out a host from the LB (OpenWrt router) before working on it</li>
	    <li>VM creation and network setup via vagrant</li>
	    <li>VM's user/keys/routing/ipv6 setup</li>
	    <li>Host SSH certificate for rotating VMs on the same IP</li>
	    <li>DNS setup, with auto-detection of external IPv4 and local IPv6 addresses via ansible delegation</li>
	    <li>Vaulted and encrypted token to update demi-ns.dynv6.net</li>
	    <li>Nginx's first stage: :80 with basic redirect and acme challenges</li>
	    <li>Let's Encrypt account creation and certification with a challenge workflow that works across hosts</li>
	    <li>Nginx's second stage: :443 with new certificate and the site's webfiles</li>
	    <li>Reverse proxy to my NAS through nginx</li>
	    <li>SingleSignOn-based key setup for NAS access, through an nginx-fronted uwsgi+flask server</li>
	  </ul>
	  And finally to tie it all up, a playbook that can also destroy everything, and run everything above; it takes
	  around 1 minute to run from start to end, and about 10 seconds to run it again just to modify things.
	</p>
	<p>
	  There's also some really cool invariants for all the above steps:
	  <ul>
	    <li>Private keys never leave the host they are on, even when signing keys for other hosts</li>
	    <li>As a result of the above, any private keys the VM has are ephemeral, and useless once recreated</li>
	    <li>The playbooks themselves contain no passwords, keys or secrets, unless encrypted in a vault</li>
	    <li>The VM has no way to log in to its host, and never sees letsencrypt/ssh certificate keys</li>
	  </ul>
	  I aim to achieve real security, in that there's no way I know of to break into either server even with full
	  knowledge of the setup. However, the goal is to assume that vulnerabilities will exist, and can be used to
	  gain root access to a server, so all internet-facing services are on the VM, and if anyone does get access to
	  it, the whole VM will be regularly destroyed and recreated anyway, with all packages brougth up to date.
	</p>
      </td>
    </tr>
  </table>
</body>
</html>
